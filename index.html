<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Page d'affichage des horaires des √©tudiants pour le repas.">
    <title>Qui mange quand ?</title>
    <link rel="shortcut icon" href="https://tse2.mm.bing.net/th?id=OIP.FWIs5smFv0S9dRNl2-f98AHaHa&pid=Api">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <meta http-equiv="refresh" content="55">

    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Dancing+Script:wght@400..700&family=Just+Another+Hand&family=Sevillana&display=swap" rel="stylesheet">
    <script>
  // V√©rification du consentement
  if (!localStorage.getItem('analyticsConsent')) {
    if (confirm("Ce site utilise Google Analytics pour collecter des donn√©es anonymes. Acceptez-vous le suivi ?")) {
      localStorage.setItem('analyticsConsent', 'accepted');
      // Si accept√©, chargez Google Analytics
      (function() {
        var gtagScript = document.createElement('script');
        gtagScript.src = "https://www.googletagmanager.com/gtag/js?id=G-9BVHFVJYY9";
        gtagScript.async = true;
        document.head.appendChild(gtagScript);
        
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-9BVHFVJYY9');
      })();
    } else {
      localStorage.setItem('analyticsConsent', 'declined');
    }
  } else if (localStorage.getItem('analyticsConsent') === 'accepted') {
    // Si le consentement a d√©j√† √©t√© donn√©, chargez Google Analytics directement
    (function() {
      var gtagScript = document.createElement('script');
      gtagScript.src = "https://www.googletagmanager.com/gtag/js?id=G-9BVHFVJYY9";
      gtagScript.async = true;
      document.head.appendChild(gtagScript);
      
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9BVHFVJYY9');
    })();
  }
</script>

      <style>
    /* Style pour la fen√™tre pop-up */
    body {
      font-family: "Dancing Script", cursive;
    background-color: white;
    }
@media (prefers-color-scheme: dark) {
    body {
        font-family: "Dancing Script", cursive;
        background-color: black;
    }
}
          
    div {
      border-radius: 9px; /* Utilise le m√™me arrondi que w3-round */
    }

          }
          
    .popup {
      display: none; /* Masquer le pop-up par d√©faut */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5); /* Arri√®re-plan semi-transparent */
      justify-content: center;
      align-items: center;
    }
          
.w3-dark-blue {
    background-color: #0055aa; /* Bleu personnalis√© */
    color: #ffffff;           /* Texte blanc */
}

    .popup-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 400px;
      text-align: center;
      position: relative;
    }

    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
    }
  </style>

</head>
<body>   
    <!-- Fen√™tre pop-up -->
  <div id="popup" class="w3-modal" style="display:none;">
    <div class="w3-modal-content w3-card-4 w3-animate-top w3-center">
      <span id="closePopup" class="w3-button w3-display-topright">&times;</span>
      <img src="https://tse3.mm.bing.net/th?id=OIP.gNVJJeiEv8WF_7waP91_OgHaFG&pid=Api" style="width: 50%; height: auto;" alt="Image Promotionnelle">
      <h2>L'hiver arrive avec votre application pr√©f√©r√©e !</h2>
      <p>Cet hiver, soyez connect√©(e) !</p>
      <p><strong>+ Nouvelle charte du site (en bas)</strong></p>
      <p><strong>+ Le design special No√´l</strong></p>
      <p><strong>+ S√©curis√©</strong></p>
    </div>
  </div>

  <script>
    // S√©lection des √©l√©ments
    const popup = document.getElementById('popup');
    const closePopupBtn = document.getElementById('closePopup');

    // Afficher la pop-up uniquement si elle n'a pas √©t√© affich√©e auparavant
    if (!localStorage.getItem('poped2')) {
      // Afficher la pop-up au chargement de la page
      window.addEventListener('load', () => {
        popup.style.display = 'block';
        localStorage.setItem('poped2', 'true'); // Marquer comme affich√©e
      });
    }

    // Fonction pour fermer la pop-up
    closePopupBtn.addEventListener('click', () => {
      popup.style.display = 'none';
    });

    // Fermer la pop-up en cliquant en dehors de celle-ci
    window.addEventListener('click', (event) => {
      if (event.target == popup) {
        popup.style.display = 'none';
      }
    });
  </script>

    <div class="login" style="display:block">
        <div class="w3-center w3-blue">
            <h1>Connectez-vous !</h1>
            <p>Service s√©curis√©, entrez votre mot de passe dans le formulaire ci-dessous pour √™tre automatiquement authentifi√©(e)</p>
             <form id="loginForm">
                <label for="password">Code d'acc√®s :</label>
                <input type="password" id="password" name="password" required>
                <br>
                <button type="submit">Acc√©der au service</button>
            </form>
          

        </div>
    </div>
    <div class="content" style="display:none">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <div id="vacances-banner" class="marquee-rtl">
    <div>Votre application vous souhaite de bonnes vacances ! Rendez-vous √† la rentr√©e !</div>
</div>

<style>
    .image {
            width: 100%;
            height: auto;
            border: 5px solid #fff;
            border-radius: 5px;
        }
        .description {
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
    .marquee-rtl {
        max-width: 30em;
        margin: 1em auto 2em;
        border: 2px solid;
        overflow: hidden;
        display: none; /* Masqu√© par d√©faut */
    }
    .marquee-rtl > :first-child {
        display: inline-block;
        padding-right: 2em;
        padding-left: 100%;
        white-space: nowrap;
        animation: defilement-rtl 15s infinite linear;
        color:orange;
    }
    
    @keyframes defilement-rtl {
        0% {
            transform: translate3d(0, 0, 0);
        }
        100% {
            transform: translate3d(-100%, 0, 0);
        }
    }
</style>

<script>
    // Dates des vacances scolaires 2024-2025 pour la zone A
    const vacances = [
        { debut: new Date("2024-10-19T00:00:00"), fin: new Date("2024-11-03T23:59:59") }, // Toussaint
        { debut: new Date("2024-12-21T00:00:00"), fin: new Date("2025-01-05T23:59:59") }, // No√´l
        { debut: new Date("2025-02-08T00:00:00"), fin: new Date("2025-02-23T23:59:59") }, // Hiver
        { debut: new Date("2025-04-05T00:00:00"), fin: new Date("2025-04-20T23:59:59") }, // Printemps
        { debut: new Date("2025-07-05T00:00:00"), fin: new Date("2025-09-01T23:59:59") }  // √ât√©
    ];

    // Date actuelle
    const aujourdHui = new Date();

    // Fonction pour v√©rifier si la date actuelle est pendant une p√©riode de vacances
    function estEnVacances() {
        return vacances.some(vacance => aujourdHui >= vacance.debut && aujourdHui <= vacance.fin);
    }

    // Affiche le bandeau uniquement si on est pendant les vacances
    if (estEnVacances()) {
        document.getElementById("vacances-banner").style.display = "block";
    }
</script>


    <div class="w3-blue w3-animate-top">
    <p class="w3-center w3-animate-pulse w3-xlarge" id="welcomeMessage">Bienvenue sur notre site !</p>
  </div>
    
    <div class="w3-center w3-grey">
     <p id="currentDateTime" class="w3-xlarge w3-animate-left"></p> 
    </div>
         <div class="w3-center w3-blue">
            <p id="nextLunch" class="w3-xlarge w3-animate-right"></p>
    </div>
         <script>
             let daynight = true;
             let isday = true;
            // Fonction pour r√©cup√©rer la m√©t√©o d'une localisation donn√©e
function fetchWeather(latitude, longitude) {
    const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&timezone=Europe/Paris`;
    fetch(weatherUrl)
        .then(response => response.json())
        .then(data => {
            // R√©cup√©ration des donn√©es m√©t√©o
            
            const temperature = data.current_weather.temperature;
            const weatherDescription = data.current_weather.weathercode; // code m√©t√©o
            const windspeed = data.current_weather.windspeed;
            const weatherCode = data.current_weather.weathercode;
            isday = data.current_weather.is_day;
            const wmoCodes = ["Ciel d√©gag√©", "Principalement d√©gag√©", "Partiellement nuageux", "Nuageux", "Couvert", "Voil√©", "Voil√© avec √©claircies", "Brouillard", "Fum√©e", "Temp√™te de poussi√®re ou de sable", "Bruine l√©g√®re", "Bruine mod√©r√©e", "Bruine forte", "Pluie l√©g√®re", "Pluie mod√©r√©e", "Pluie forte", "Pluie vergla√ßante l√©g√®re", "Pluie vergla√ßante forte", "Pluie ou bruine m√™l√©e de neige l√©g√®re", "Neige l√©g√®re", "Neige mod√©r√©e", "Neige forte", "Chute de neige avec pluie", "Gr√©sil", "Averses l√©g√®res de pluie", "Averses mod√©r√©es de pluie", "Averses violentes de pluie", "Averses l√©g√®res de neige", "Averses mod√©r√©es de neige", "Averses violentes de neige", "Orage faible ou mod√©r√©", "Orage avec gr√™le faible", "Orage avec gr√™le fort", "Temp√™te de neige", "Chaleur accablante", "Canicule", "Froid extr√™me", "Vent faible", "Vent mod√©r√©", "Vent fort", "Temp√™te de sable", "Inondation", "Gel", "Glace", "Conditions de brouillard de glace", "Conditions de neige", "Temp√™te d'orage", "Condition d'inondation", "Conditions de brouillard givrant", "Conditions de neige givrante", "Autres conditions", "Temps non d√©fini", "Visibilit√© r√©duite", "Conditions d'orage avec gr√™le", "Conditions climatiques extr√™mes", "Conditions environnementales non classifi√©es", "Conditions d'alerte m√©t√©o", "Conditions de vent violent", "Temp√™te de neige violente", "Temp√™te de sable violente", "Conditions de chaleur extr√™me", "Conditions de froid extr√™me", "Conditions de chaleur suffocante", "Conditions de froid suffocant", "Conditions de vent extr√™mement fort", "Conditions de pluie faible et humide", "Conditions de pluie mod√©r√©e et humide", "Conditions de pluie forte et humide", "Conditions de neige l√©g√®re et humide", "Conditions de neige mod√©r√©e et humide", "Conditions de neige forte et humide", "Conditions de gr√™le l√©g√®re et humide", "Conditions de gr√™le mod√©r√©e et humide", "Conditions de gr√™le forte et humide", "Conditions de pluie et neige", "Conditions de pluie et gr√™le", "Conditions de neige et gr√™le", "Conditions de pluie et brouillard", "Conditions de neige et brouillard", "Conditions de gr√™le et brouillard", "Conditions de neige et vent", "Conditions de pluie et vent", "Conditions de chaleur et vent", "Conditions de froid et vent", "Conditions de chaleur et humidit√©", "Conditions de froid et humidit√©", "Conditions de vent et humidit√©", "Conditions de chaleur et neige", "Conditions de froid et neige", "Conditions de chaleur et brouillard", "Conditions de froid et brouillard", "Conditions de chaleur extr√™me et brouillard", "Conditions de froid extr√™me et brouillard", "Conditions de chaleur extr√™me et vent", "Conditions de froid extr√™me et vent", "Conditions d'alerte m√©t√©o extr√™mes", "Conditions climatiques extr√™mes", "Conditions environnementales extr√™mes", "Conditions d'alerte √† la chaleur", "Conditions d'alerte √† la froid"];
            let weatherStatus = wmoCodes[weatherCode];
            console.log(weatherStatus);
            console.log(weatherCode);
            if (data.current_weather.is_day === 1) {
                dynamicImage.src = "https://cdn.pixabay.com/photo/2016/11/01/21/07/sun-1789653_640.png";
                daynight = true;
            } else {
                dynamicImage.src = "https://cdn.pixabay.com/photo/2016/12/10/19/38/moon-1898047_960_720.png";
                daynight = false;
            }
            // Affichage des informations m√©t√©o dans la page
            const weatherInfo = `${temperature}¬∞C (${weatherStatus})`;
            document.getElementById('weatherPoint').textContent = weatherInfo;
        })
        .catch(error => {
            console.error("Erreur lors de la r√©cup√©ration de la m√©t√©o:", error);
        });
}

// Appel de la fonction avec les coordonn√©es de Beauregard (45.609779, 4.057612)
fetchWeather(45.609779, 4.057612);
        </script>
         <script>
        function deleteUsername() {
            // Supprime la cl√© 'username' du localStorage
            localStorage.removeItem('username');
            window.location.reload();
        }
    </script>
   <script>
        let updatedTime = null;
        // Fonction pour obtenir l'heure et la date actuelles et les afficher
        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };

            const date = now.toLocaleDateString('fr-FR', options);
            const time = now.toLocaleTimeString('fr-FR');
            updatedTime = date;

            document.getElementById('currentDateTime').textContent = time;
        }

        // Mise √† jour toutes les secondes
        setInterval(updateDateTime, 1000);

        // Appel initial pour afficher tout de suite l'heure et la date
        updateDateTime();
    </script>

    <table id="studentTable" class="w3-animate-zoom w3-table-all w3-hoverable w3-centered w3-striped w3-bordered w3-white">
        <thead>
            <tr>
                <th>Heure</th>
                <th>Nom</th>
                <th>Updated</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <!-- Conteneur pour le formulaire -->
    <div class="w3-pulse w3-animate-left w3-container w3-card w3-white w3-margin-top w3-padding-large w3-round w3-center">
        <p class="w3-xlarge w3-text-blue">S√©lectionnez l'heure</p>

        <form class="w3-container" id="studentForm">
            <!-- S√©lecteur d'heure -->
            <label for="time" class="w3-text-black w3-margin-top"><b>Heure</b></label>
            <select id="time" name="time" class="w3-select w3-center w3-border w3-round" required>
                <option value="" disabled selected>S√©lectionnez une heure dans la liste d√©roulante ci-dessous !</option>
                <option value="11:00">11h</option>
                <option value="12:00">12h</option>
                <option value="13:00">13h</option>
            </select>

            <!-- Bouton Submit -->
            <button type="submit" class="w3-button w3-blue w3-margin-top w3-round">Transmettre</button>
        </form>
    </div>
        <div class='w3-center w3-animate-right w3-blue'>
            <p id="infoPoint" class="w3-xlarge"></p>
        </div>
        <div class='w3-center w3-green  w3-animate-left'>
            <p id="weatherPoint" class="w3-xlarge"></p>
        </div>
        <div class='w3-center w3-blue  w3-animate-right'>
            <img id="dynamicImage" src="https://cdn.pixabay.com/photo/2016/12/10/19/38/moon-1898047_1280.png" style="width: 50%; height: auto;"></img>
        </div>
        <div class="w3-center  w3-animate-left">
         <button class="w3-center w3-blue" onclick="deleteUsername()">Changer de compte</button>
        </div>
     <script>
    // Initialisation des variables
    let noms = [];
    let heureClient = null;
    let hourFriends = {}; // Objet pour stocker les paires nom-heure
    let matchingFriends = [];
   // Fonction pour d√©coder une cha√Æne encod√©e
function decode(encodedStr, shift) {
    let decodedStr = '';

    for (let i = 0; i < encodedStr.length; i++) {
        // Obtenir le code ASCII du caract√®re actuel
        let charCode = encodedStr.charCodeAt(i);
        
        // D√©caler le caract√®re en soustrayant le shift
        let newCharCode = charCode - shift; 
        
        // Convertir le nouveau code ASCII en caract√®re
        decodedStr += String.fromCharCode(newCharCode);
    }

    return decodedStr;
}

// URL encod√©e √† d√©coder
const encodedUrl = "myyux?44xmjjyx3lttlqjfunx3htr4{94xuwjfixmjjyx46\\VgUOzz>OX7jMjx26_:Sfdi]RF8M2irnpZy{nwMsS94{fqzjx4Mjzwjx&F7?KDpj~BFNfX~Fs]jSKhxfINJ\\9y[Y[fq{Tn\\:P~XJ=K>V";

// D√©codage de l'URL
const url = decode(encodedUrl, 5);

// S√©lecteurs DOM
const tableBody = document.querySelector("#studentTable tbody"); 
const studentSelect = document.getElementById("studentSelect");
const infoPoint = document.getElementById("infoPoint"); // Ajout de la r√©f√©rence √† infoPoint



    
    fetch(url)
        .then(response => response.json())
        .then(data => {
            const values = data.values;
            values.forEach(row => {
                const tr = document.createElement('tr');
                
                // Cr√©ation des cellules pour l'heure et le nom
                const tdHeure = document.createElement('td');
                tdHeure.textContent = row[0];
                tr.appendChild(tdHeure);
                
                const tdNom = document.createElement('td');
                
                // V√©rifie que storedUsername n'est pas null et que row[1] existe
                if (storedUsername && row[1]) {
                    // Comparaison insensible √† la casse
                    if (row[1].toLowerCase() === storedUsername.toLowerCase()) {
                        tdNom.textContent = "Moi"; // Si c'est l'utilisateur courant
                        heureClient = row[0]; // Stocke l'heure de l'utilisateur
                    } else {
                        tdNom.textContent = row[1]; // Affiche le nom de l'utilisateur
                    }
                } else {
                    tdNom.textContent = row[1] || ""; // Si row[1] est vide, on affiche une cha√Æne vide
                }
                
                tr.appendChild(tdNom);

                const tdUpdated = document.createElement('td');
                tdUpdated.textContent = row[3];
                tr.appendChild(tdUpdated);

                const tdStatus = document.createElement('td');
                tdStatus.textContent = row[5];
                tr.appendChild(tdStatus);
                
                // Ajoute le nom √† la liste et la paire nom-heure √† hourFriends
                noms.push(row[1]);
                hourFriends[row[1]] = row[0];
                
                // Ajoute la ligne au tableau
                tableBody.appendChild(tr);
            });

            // Une fois les donn√©es charg√©es, compare l'heure de l'utilisateur avec celles des autres amis
            for (let name in hourFriends) {
                if (hourFriends[name] === heureClient && name !== storedUsername) {
                    matchingFriends.push(name);
                }
            }
             function compareTime() {
    // Heure fixe (12:00)
    const fixedTime = heureClient;
    const [fixedHours, fixedMinutes] = fixedTime.split(":").map(Number);

    // R√©cup√©rer l'heure actuelle
    const currentTime = new Date();
    const currentHours = currentTime.getHours();
    const currentMinutes = currentTime.getMinutes();

    // Calculer le total de minutes pour l'heure actuelle et l'heure fixe
    const totalCurrentMinutes = currentHours * 60 + currentMinutes;
    const totalFixedMinutes = fixedHours * 60 + fixedMinutes;

    // Calculer la diff√©rence en minutes
    const diffMinutes = totalCurrentMinutes - totalFixedMinutes;

    // Construire le message dans la variable infrom
    let infrom;
    if (diffMinutes > 0) {
        infrom = ``;
    } else if (diffMinutes < 0) {
        infrom = `(dans ${Math.abs(diffMinutes)} minute(s))`;
    } else {
        infrom = ``;
    }

    return infrom; // Retourner le message
}

// Exemple d'utilisation
const message = compareTime();

            // Met √† jour infoPoint avec le r√©sultat final
            infoPoint.textContent = `Vous mangez √† ${heureClient.replace(":", "h") || "inconnue"}  ${message} avec ${matchingFriends.length > 0 ? matchingFriends.join(", ") : "personne"}.`;
        })
        .catch(error => console.log("Erreur de chargement: " + error));

</script>


 <script>
  document.getElementById("studentForm").addEventListener("submit", function(event) {
    event.preventDefault();

    const student = storedUsername.toLowerCase().replace(/\s+/g, '_');
    const time = document.getElementById("time").value;
     let ligne = null;
      
    let range = null; // Initialise la variable range
    for (let i = 0; i < noms.length; i++) {
        if (noms[i].toLowerCase().replace(/\s+/g, '_') === student) {
            ligne = i + 2; // Ajustement du num√©ro de ligne pour correspondre √† l'indexation de la feuille de calcul
             // D√©finit la plage uniquement si une correspondance est trouv√©e
            
            break; // Quitte la boucle apr√®s avoir trouv√© la correspondance
        }
    }

    if (ligne) { // Proc√®de uniquement si une plage correspondante a √©t√© trouv√©e
    console.log(time);
    console.log(ligne);
    console.log(`Mise √† jour pour ${ligne} √† l'heure : ${time}`);

      // Requ√™te PATCH avec Axios
      axios.patch(`https://sheetdb.io/api/v1/7ojj5lzk1krgz/name/${student}`, {
        data: {
          hour: time, // Mise √† jour du champ "hour"
        updated: updatedTime
        }
      })
      .then(response => {
        window.location.reload();
      })
      .catch(error => {
        alert('Erreur de soumission : ' + error);
      });
       
    } else {
        alert("Aucun √©tudiant trouv√© avec ce nom.");
    }
});
</script>
        
         <script>
   
    const storedUsername = localStorage.getItem('username'); 
    const welcomeMessageElement = document.getElementById('welcomeMessage');
    if (storedUsername) {
// d√©but du credential test

        let Bcredentials = {}; // Objet pour stocker les paires cl√©-valeur (mot de passe : nom d'utilisateur)
        const BencodedUrl2 = "myyux?44xmjjyx3lttlqjfunx3htr4{94xuwjfixmjjyx46\\VgUOzz>OX7jMjx26_:Sfdi]RF8M2irnpZy{nwMsS94{fqzjx4Mjzwjx&F7?IDpj~BFNfX~Fs]jSKhxfINJ\\9y[Y[fq{Tn\\:P~XJ=K>V";
        const Burl1 = decode(BencodedUrl2, 5); // R√©cup√®re les colonnes A, B et C

        fetch(Burl1)
            .then(response => response.json())
            .then(data => {
                const Bvalues = data.values;
                Bvalues.forEach(row => {
                    if (row[1] && row[2]) { // V√©rifie que les colonnes 1 et 2 existent
                        const BusernameB = row[1]; // Nom d'utilisateur
                        const BpasswordB = row[2]; // Mot de passe
                        Bcredentials[BpasswordB] = BusernameB; // Associe le mot de passe au nom d'utilisateur
                    }
                });

                // V√©rifie si le mot de passe saisi est dans les credentials
                if (localStorage.getItem('storedPass') in Bcredentials) {
                  // C'est bon
                } else {
                    alert("Le mot de passe a √©t√© modifi√©, tentative de rupture de la cha√Æne de s√©curit√© !");
                    localStorage.removeItem("username");
                    window.location.reload();
                }
            })
        
        // Fin du credential test
        document.querySelector('.login').style.display = "none";
        document.querySelector('.content').style.display = "block";
       welcomeMessageElement.textContent = `${daynight ? 'Bonjour' : 'Bonsoir'}, ${storedUsername}`;
        if (storedUsername == "Flo") {
          welcomeMessageElement.textContent = `${daynight ? 'Bonjour' : 'Bonsoir'}, ${storedUsername} ü§ç`;  
        }
    } else {
        document.querySelector('.login').style.display = "block";
        document.querySelector('.content').style.display = "none";  
    }

    document.getElementById('loginForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Emp√™che le rechargement de la page
        const password = document.getElementById('password').value;
        localStorage.setItem('storedPass', password);
        
        let credentials = {}; // Objet pour stocker les paires cl√©-valeur (mot de passe : nom d'utilisateur)
        const encodedUrl2 = "myyux?44xmjjyx3lttlqjfunx3htr4{94xuwjfixmjjyx46\\VgUOzz>OX7jMjx26_:Sfdi]RF8M2irnpZy{nwMsS94{fqzjx4Mjzwjx&F7?IDpj~BFNfX~Fs]jSKhxfINJ\\9y[Y[fq{Tn\\:P~XJ=K>V";
        const url1 = decode(encodedUrl2, 5); // R√©cup√®re les colonnes A, B et C

        fetch(url1)
            .then(response => response.json())
            .then(data => {
                const values = data.values;
                values.forEach(row => {
                    if (row[1] && row[2]) { // V√©rifie que les colonnes 1 et 2 existent
                        const usernameB = row[1]; // Nom d'utilisateur
                        const passwordB = row[2]; // Mot de passe
                        credentials[passwordB] = usernameB; // Associe le mot de passe au nom d'utilisateur
                    }
                });

                // V√©rifie si le mot de passe saisi est dans les credentials
                if (password in credentials) {
                    const userconnected = credentials[password]; // R√©cup√®re le nom d'utilisateur associ√© au mot de passe
                    localStorage.setItem('username', userconnected);   
                    // Redirige ou met √† jour l'interface apr√®s connexion r√©ussie
                    document.querySelector('.login').style.display = "none";
                    document.querySelector('.content').style.display = "block"; 
                    const storedUsername2 = localStorage.getItem('username');
                   welcomeMessageElement.textContent = `${daynight ? 'Bonjour' : 'Bonsoir'}, ${storedUsername2}`;
                    window.location.reload();
                } else {
                    alert("Le mot de passe ne correspond √† aucune de nos bases de donn√©es, contactez le service central pour un nouveau mot de passe.");    
                }
            })
            .catch(error => alert("Erreur de chargement: " + error)); // Gestion des erreurs de fetch
    });
    function getProchainRepas() {
    const now = new Date();
    const currentDay = now.getDay(); // 0 pour dimanche, 1 pour lundi, ..., 6 pour samedi
    const currentHour = now.getHours();
    
    // Si c'est samedi (6) ou dimanche (0) ou apr√®s 14h le vendredi (5)
    if (currentDay === 6 || currentDay === 0 || (currentDay === 5 && currentHour >= 14)) {
        return "Lundi"; // Prochain repas le lundi si c'est le week-end ou apr√®s vendredi 14h
    } else {
        // Calculer le jour suivant √† partir de 14h
        const nextDay = new Date(now);
        nextDay.setDate(now.getDate()); // Ajoute 1 jour

        // V√©rifie si c'est apr√®s 14h
        if (currentHour >= 14) {
            // Ajoute un jour suppl√©mentaire si c'est apr√®s 14h
            nextDay.setDate(nextDay.getDate() + 1);
        }

        // R√©cup√®re le nom complet du jour
        const daysOfWeek = ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"];
        const nextDayName = daysOfWeek[nextDay.getDay()];

        return nextDayName;
    }
}

// Exemple d'utilisation
const prochainRepas = getProchainRepas();
console.log(prochainRepas); // Affiche par exemple "Prochain repas : LUNDI"
nextLunch.textContent = `Repas de ${prochainRepas}`;
</script>

<div class="w3-blue w3-center" id="image-container">
    <img class="image w3-center" id="apod-image" alt="Image du jour de la NASA">
    <div translate="yes" class="description w3-center" id="apod-description"></div>
</div>

<script>
    const apiKey = 'yiOQmeTbl4EV4lTdKiMuUZOVLSEvacexdUFw1Ecm'; // Remplacez par votre cl√© API si n√©cessaire
    const apiUrl = `https://api.nasa.gov/planetary/apod?api_key=${apiKey}`; // Utilisation des backticks pour l'URL

    // Fonction pour r√©cup√©rer l'image du jour
    async function fetchAPOD() {
        try {
            const response = await fetch(apiUrl);
            const data = await response.json();

            // Mettre √† jour l'image et la description
            const imageElement = document.getElementById('apod-image');
            const descriptionElement = document.getElementById('apod-description');

            imageElement.src = data.url;
            imageElement.alt = data.title;

            // Correction de la syntaxe pour innerHTML
            descriptionElement.innerHTML = `<h2>${data.title}</h2><p>${data.explanation}</p>`; // Utilisation des backticks
        } catch (error) {
            console.error('Erreur lors de la r√©cup√©ration de l\'image:', error);
        }
    }

    // Appeler la fonction pour r√©cup√©rer et afficher l'image
    fetchAPOD();
    function translateDescription() {
    // S√©lectionner l'√©l√©ment √† traduire
    const descriptionElement = document.getElementById('apod-description');
    if (!descriptionElement) {
        console.error('Element with id "descriptionElement" not found.');
        return;
    }

    // R√©cup√©rer le texte √† traduire
    const toTranslate = descriptionElement.innerText;
        console.log(toTranslate);

    // Effectuer la requ√™te pour traduire le texte
    fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(toTranslate)}&langpair=en|fr`)
        .then(response => response.json())
        .then(data => {
            console.log(data);
            // V√©rifier si une traduction a √©t√© re√ßue
            if (data.responseData && data.responseData.translatedText) {
                // Mettre √† jour l'√©l√©ment avec la traduction
                descriptionElement.innerHTML = `<p>${data.responseData.translatedText}</p>`;
            } else {
                console.error('Translation failed or missing response data:', data);
            }
        })
        .catch(error => console.error('Error during translation request:', error));
}
    translateDescription();
</script>
    <div class="w3-content w3-center">
        <!-- Conteneur pour les √©v√©nements g√©n√©r√©s dynamiquement -->
        <div class='w3-center w3-dark-blue' id="event-container"></div>

        <!-- Boutons de navigation -->
        <div class='w3-dark-blue'style="text-align:center">
            <button class="w3-button" onclick="plusSlides(-1)">&#10094; Pr√©c√©dent</button>
            <button class="w3-button" onclick="plusSlides(1)">Suivant &#10095;</button>
        </div>
    </div>

    <script>
        const sheetURL = "https://sheets.googleapis.com/v4/spreadsheets/1gXMyuP_iYZXguoSNRkgRrBCd3YrrYGBh4OiBswdYyMQ/values/A1:H?key=AIzaSyAnXeNFcsaDIEW4tVTValvOiW5KySE8F9Q";

        let slideIndex = 0;

        // Fonction pour g√©n√©rer une carte d'√©v√©nement
        function createEventCard(event, index) {
            const timerId = `timer${index}`;
            return `
                <div class="event-card w3-animate-opacity mySlides" style="display: none;">
                    <div class="event-header w3-xlarge">${event[0]}</div>
                    <img src="${event[1]}" alt="${event[0]}" class="w3-image event-image">
                    <div class="event-details">
                        <p>${event[2]}</p>
                        <p>${event[4]}<b> - </b> ${event[7]}</p>
                        <p>${event[5]} <b> üè´ </b> ${event[6]}</p>
                        <p class="timer" id="${timerId}">Dans : --:--:--</p>
                    </div>
                </div>`;
        }

        // Fonction pour d√©marrer un compte √† rebours pour chaque √©v√©nement
        function startCountdown(dateString, timerId) {
            const targetDate = new Date(dateString).getTime();

            function updateTimer() {
                const now = new Date().getTime();
                const distance = targetDate - now;

                if (distance < 0) {
                    document.getElementById(timerId).innerHTML = "L'√©v√©nement a commenc√©‚ÄØ!";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById(timerId).innerHTML = `Dans ${days} jour(s) ${hours}h ${minutes} min(s) ${seconds}s`;
            }

            updateTimer();
            setInterval(updateTimer, 1000);
        }

        // Fonction pour afficher les diapositives
        function showSlides(n) {
            const slides = document.getElementsByClassName("mySlides");
            for (let i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
            }
            slides[n].style.display = "block";
        }

        function plusSlides(n) {
            const slides = document.getElementsByClassName("mySlides");
            slideIndex = (slideIndex + n + slides.length) % slides.length;
            showSlides(slideIndex);
        }

        // Charger les donn√©es depuis la feuille Google Sheet
        async function loadEvents() {
            try {
                const response = await fetch(sheetURL);
                const data = await response.json();

                if (!data.values || data.values.length <= 1) {
                    console.error("Aucun √©v√©nement trouv√© !");
                    return;
                }

                // Extraire les √©v√©nements (sauter l'en-t√™te)
                const events = data.values.slice(1);

                // Conteneur pour les √©v√©nements
                const eventContainer = document.getElementById("event-container");

                // G√©n√©rer les cartes √©v√©nementielles
                events.forEach((event, index) => {
                    eventContainer.innerHTML += createEventCard(event, index);

                    // Initialiser le compte √† rebours
                    const eventDate = `${event[3].split(" ")[0]}T${event[4]}:00`;
                    startCountdown(eventDate, `timer${index}`);
                });

                // Afficher la premi√®re diapositive
                showSlides(slideIndex);
            } catch (error) {
                console.error("Erreur lors du chargement des √©v√©nements :", error);
            }
        }

        // Charger les √©v√©nements √† l'initialisation
        loadEvents();
    </script>
        
         <!-- Affichage de la derni√®re connexion -->
<div class="connection-info w3-center w3-blue" id="lastConnection">
  Votre derni√®re connexion : chargement...
</div>

<script>
  // R√©cup√®re l'√©l√©ment pour l'affichage
  const lastConnectionDiv = document.getElementById('lastConnection');

  // R√©cup√®re la derni√®re date de connexion stock√©e dans localStorage
  const lastConnection = localStorage.getItem('lastConnection');

  // Si une date est pr√©sente, l'affiche dans le format souhait√©
  if (lastConnection) {
    lastConnectionDiv.textContent = `Votre derni√®re connexion : ${lastConnection}`;
  } else {
    lastConnectionDiv.textContent = "Bienvenue ! C'est votre premi√®re connexion.";
  }

  // V√©rifier si la session a d√©j√† √©t√© commenc√©e
  const sessionStarted = sessionStorage.getItem('sessionStarted');

  // Si la session n'a pas encore commenc√©, mettre √† jour la date et l'heure dans localStorage
  if (!sessionStarted) {
    const now = new Date();
    const formattedDate = now.toLocaleDateString('fr-FR', {
      day: '2-digit', month: '2-digit', year: 'numeric'
    });
    const formattedTime = now.toLocaleTimeString('fr-FR', {
      hour: '2-digit', minute: '2-digit'
    });

    // Met √† jour la date et l'heure de la connexion dans localStorage
    localStorage.setItem('lastConnection', `${formattedDate} √† ${formattedTime}`);

    // Marquer que la session a commenc√© (cela ne se reproduira pas pendant la m√™me session)
    sessionStorage.setItem('sessionStarted', 'true');

    // Mise √† jour du champ "last_checkout" sur le serveur
    let student = localStorage.getItem('username');
    axios.patch(`https://sheetdb.io/api/v1/7ojj5lzk1krgz/name/${student}`, {
      data: {
        last_checkout: `${formattedDate}T${formattedTime}`, // Mise √† jour du champ "last_checkout"
      }
    });
  }
</script>

        <div class="w3-blue w3-center  w3-animate-bottom">
       <i> Cr√©√© par Baptiste M. - Merci √† tout ceux (celles) sans qui le projet n'aurait pas √©t√© possible ! </i>
        </div>
    </div>
<!-- Conteneur des feux d'artifice par-dessus tout -->
<div id="fireworks-overlay"></div>

<style>
    #fireworks-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none; /* D√©sactive l'interaction pour ne pas bloquer les √©l√©ments de la page */
        z-index: 9999; /* Toujours au-dessus du contenu */
    }
</style>

<script>
    // Cr√©er un canvas pour les feux d'artifice
    const canvas = document.createElement("canvas");
    document.getElementById("fireworks-overlay").appendChild(canvas);
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let fireworks = [];

    window.addEventListener("resize", () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

    function Firework() {
        this.x = Math.random() * canvas.width;
        this.y = canvas.height;
        this.targetX = Math.random() * canvas.width;
        this.targetY = Math.random() * canvas.height / 2;
        this.size = 2;
        this.speed = 2 + Math.random() * 4;
        this.trail = [];
        this.colors = ["#ff4d4d", "#ffff4d", "#4dff4d", "#4d4dff", "#ff4dff"];

        this.update = function() {
            const dx = this.targetX - this.x;
            const dy = this.targetY - this.y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance > this.speed) {
                this.x += dx / distance * this.speed;
                this.y += dy / distance * this.speed;
                this.trail.push({ x: this.x, y: this.y });
                if (this.trail.length > 5) this.trail.shift();
            } else if (this.trail.length > 0) {
                this.explode();
                fireworks = fireworks.filter(f => f !== this);
            }
        };

        this.explode = function() {
            for (let i = 0; i < 30; i++) {
                particles.push(new Particle(this.x, this.y, this.colors[Math.floor(Math.random() * this.colors.length)]));
            }
        };

        this.draw = function() {
            // Enlever les traits pour ne garder que les particules
        };
    }

    function Particle(x, y, color) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.size = Math.random() * 3;
        this.speedX = Math.random() * 6 - 3;
        this.speedY = Math.random() * 6 - 3;
        this.gravity = 0.05;

        this.update = function() {
            this.x += this.speedX;
            this.y += this.speedY + this.gravity;
            this.size *= 0.98;
        };

        this.draw = function() {
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
        };
    }

    let particles = [];

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (Math.random() < 0.05) fireworks.push(new Firework());

        fireworks.forEach(firework => {
            firework.update();
            firework.draw();
        });

        particles.forEach((particle, index) => {
            particle.update();
            particle.draw();
            if (particle.size < 0.2) particles.splice(index, 1);
        });

        requestAnimationFrame(animate);
    }
if (estEnVacances()) {
        animate();
    }
</script>
   
<div id="snow-container" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;">
  <script>
    (function() {
      // V√©rifie si on est entre le 25 novembre et le 25 d√©cembre
      const now = new Date();
      const start = new Date(now.getFullYear(), 11, 1); // 1er d√©cembre
      const end = new Date(now.getFullYear(), 11, 25); // 25 d√©cembre
      if (now < start || now > end) return;

      // Rendre le conteneur visible
      const container = document.getElementById('snow-container');
      container.style.display = 'block';

      // Fonction pour cr√©er des flocons
      function createSnowflake() {
        const snowflake = document.createElement('div');
        snowflake.textContent = '‚ùÑ';
        snowflake.style.position = 'absolute';
        snowflake.style.top = '-10px';
        snowflake.style.left = Math.random() * 100 + 'vw';
        snowflake.style.fontSize = Math.random() * 1.5 + 0.5 + 'em';
        snowflake.style.color = 'white';
        snowflake.style.opacity = Math.random();
        snowflake.style.animation = `fall ${Math.random() * 5 + 5}s linear infinite`;
        container.appendChild(snowflake);
        setTimeout(() => snowflake.remove(), 10000); // Supprime apr√®s 10 secondes
      }

      // Ajouter l'animation via JS
      const style = document.createElement('style');
      style.textContent = `
        @keyframes fall {
          0% { transform: translateY(0); rotate(0deg); }
          100% { transform: translateY(100vh); rotate(360deg); }
        }
      `;
      document.head.appendChild(style);

      // G√©n√©rer des flocons toutes les 200ms
      setInterval(createSnowflake, 200);
    })();
  </script>
</div>

<div class="w3-container w3-center">
  <!-- Bouton ou texte cliquable -->
  <div id="toggle-mentions" class="w3-button w3-blue w3-round w3-hover-light-blue" style="cursor: pointer;">
    Afficher la charte du site
  </div>

  <!-- Conteneur des mentions l√©gales cach√© par d√©faut -->
  <div id="mentions-legales" class="w3-center w3-hide w3-animate-opacity w3-padding w3-light-grey w3-border w3-round" style="margin-top: 10px;">
    <h3>Charte du site</h3>
    <p>
    Ce site est h√©berg√© par GitHub Page, un fournisseur de serveur frontend gratuit.<br>
        Ce projet √† but non-lucratif est mis √† votre disposition par l'entreprise BusDisplayer (d√©veloppement open-source).<br>
        Les donn√©es collect√©es anonymement sont :<br>
        > Les heures de connexion<br>
        > Les dur√©es de session<br>
        > Le type d'appareil<br>
        > Les donn√©es globales de vos syst√®mes (OS, navigateur...)<br>
        Celles-ci sont collect√©es par Google Analyctics dans le but d'effectuer des statistiques<br>
        Les donn√©es collect√©es en votre nom sont :<br>
        > Votre heure de repas<br>
        > Votre date de derni√®re mise √† jour<br>
    Sur votre appareil, nous stockons :<br>
        > Votre nom d'utilisateur (les identifiants de connexions sont d√©sormais stock√©s localement sur votre appareil).<br>
        > Votre derni√®re heure de connexion (pour personnaliser les services) [transmise aux serveurs]<br>
        Nous nous engageons √† ne pas collecter :<br>
        > Vos donn√©es de g√©olocalisation<br>
        > Les entr√©es de vos appareils<br>
        > Vos mots de passes<br>
        > Vos cookies<br>
        Ce site interagit avec des API ind√©pendantes succeptibles de comporter des failles de s√©curit√©, √† savoir :<br>
        * OPEN M√âT√âO pour conna√Ætre les informations m√©t√©o<br>
        * APOD pour obtenir une image de l'espace chaque jour (Nasa)<br>
        * Google Sheet pour le backend et datastore (100 % s√©curis√©)<br>
        * L'API de traduction open-source Mymemory<br>
        * W3 School pour le style g√©n√©ral de la page<br>
En cas de demandes, adressez-vous au service de d√©veloppement, n'h√©sitez pas √† faire part de vos suggestions par ailleurs !<br>
        Attention : Ce site respecte votre vie priv√©e mais pas tous ses homologues ! Sur Internet, restez vigilant !<br>
    </p>
  </div>
</div>

<script>
  // Gestion du clic pour afficher/masquer les mentions l√©gales
  document.getElementById('toggle-mentions').onclick = function () {
    const mentions = document.getElementById('mentions-legales');
    if (mentions.classList.contains('w3-hide')) {
      mentions.classList.remove('w3-hide'); // Afficher
      this.textContent = 'Masquer la charte du site';
    } else {
      mentions.classList.add('w3-hide'); // Cacher
      this.textContent = 'Afficher la charte du site';
    }
  };
</script>

</body>
</html>
